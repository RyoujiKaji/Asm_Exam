![[Pasted image 20260118134723.png]]
<center>Процессор</center>
![[Pasted image 20260118134733.png]]
<center>Ядро процессора</center>
# **Процессор**
***— центральная часть ЭВМ, организующая ее работу по заданной программе и выполняющая арифметические и логические операции.***

***Быстродействие компьютера определяется тактовой частотой его процессора.*** 
#### *Тактовая частота* 
— количество тактов (соответственно и исполняемых команд) за секунду.
#### *Поток инструкций (конвейер команд)*
***Современные процессоры могут параллельно обрабатывать несколько команд***. Пока одна инструкция находится в стадии декодирования, процессор может успеть получить другую инструкцию.

Конвейер с семью ступенями, соответствующими семи [[4. Система команд. Основные этапы выполнения команды#**Основные этапы выполнения команды**|этапам цикла команды]]:
1. выборка команды (ВК);
2. декодирование команды (ДК);
3. вычисление исполнительных адресов (ВА);
4. выборка операндов (ВО);
5. исполнение операции (ИО);
6. запись результата (ЗР);
7. формирование адреса следующей команды (ФАСК).
![[Pasted image 20260118171315.png]]
Однако такое решение подходит только для тех инструкций, которые не зависят друг от друга.
### **Многоядерный процессор** 
— ***одна микросхема (кристалл), внутри которой размещены два или более независимых вычислительных ядра***.

Если процессор многоядерный, это означает, что ***фактически в нём находятся несколько отдельных процессоров с некоторыми общими ресурсами, например кэшем.***

#### *Разрядность процессора*
—  ***показатель, указывающий, сколько бит данных процессор может обрабатывать одновременно и какой объем адресуемой памяти он может поддерживать***. Это одна из ключевых характеристик, определяющая мощность и возможности процессора.
##### **Машинное слово** 

^ef99d9

— ***единица данных, с которой процессор работает за один такт.*** <u>Длина слова соответствует разрядности процессора.</u> 
##### **Адресное пространство** 
— ***совокупность всех допустимых адресов, к которым может обратиться процессор или программа*** для чтения или записи данных.
	Разрядность также определяет максимальный объем памяти, который процессор может адресовать. 

***Разрядность процессора определяет размер [[3. Функциональная и структурная организация процессора#**Регистр**|регистров]].*** В 32-битном процессоре регистры имеют размер 32 бита, в 64-битном — 64 бита (касается не всех регистров, а по большей части регистров общего назначения).

# **Структура**

### **Устройство управления (УУ)**
— отвечает за контроль компонентов и выполнение инструкций. Сюда изначально попадают все инструкции. 

 Некоторые элементы УУ:
- *Декодер инструкций* — переводит машинные инструкции из машинного кода в управляющие сигналы, которые указывают, какие операции должны быть выполнены.
- *Генератор сигналов управления* — создаёт сигналы, которые управляют различными функциями процессора, такими как чтение/запись в регистры, выбор источников данных для выполнения операций, управление памятью.
- *Счётчик инструкций* — отслеживает текущую выполняемую инструкцию и управляет последовательностью исполнения инструкций внутри процессора.
- *Управляющие регистры* — хранят состояние процессора, включая информацию о текущей инструкции, режиме работы процессора и т. д..
- *Предсказатель переходов:* В некоторых процессорах устройство управления включает предсказатель переходов, который анализирует последовательность инструкций для предсказания условных переходов, что улучшает предсказуемость ветвлений и оптимизирует выполнение программ.

***Существует два типа реализации УУ:***
- *УУ на жёсткой логике* (англ. hardwired control units). Характер работы определяется внутренним электрическим строением — устройством печатной платы или кристалла. Соответственно, модификация такого УУ без физического вмешательства невозможна.
- *УУ с микропрограммным управлением* (англ. microprogrammable control units). Может быть запрограммирован для тех или иных целей. Программная часть сохраняется в памяти УУ.

### **Планировщик (Scheduler):**
— отвечает за распределение микроопераций (micro-ops) между различными исполнительными блоками процессора, такими как АЛУ и FPU.

Он определяет порядок исполнения микроопераций, стараясь максимально эффективно использовать ресурсы процессора и минимизировать время простоя.

### **Арифметико-логическое устройство (АЛУ)**
— выполняет арифметические и логические операции. АЛУ состоит из логических элементов, которые и выполняют эти операции.

### **FPU (Floating Point Unit)**:
Выполняет операции с плавающей запятой.

### **VPU (Vector Processing Unit)**:
Выполняет операций с векторными данными.

### **MMU (Memory Management Unit)**:
— устройство управления памятью, которое обеспечивает виртуальную память, кэширование, защиту памяти и другие функции, связанные с адресацией и доступом к оперативной памяти.

### **Память процессора**
Процессор выполняет поступающие на него команды. Команды в большинстве случаев работают с данными, которые могут быть промежуточными, входными или выходными. Все эти ***данные вместе с инструкциями сохраняются в регистрах, [[2. Структура ЭВМ|основной памяти]] и кэше***.
#### **Регистр** 
— минимальная ячейка памяти данных. Регистры состоят из триггеров (англ. latches/flip-flops). Триггеры, в свою очередь, состоят из логических элементов и могут хранить в себе 1 бит информации.

На примере [[4. Система команд. Основные этапы выполнения команды|архитектуры x86]]:
##### **Регистры общего назначения** 
— обычно используются для хранения промежуточных результатов вычислений и других временных данных, которые понадобятся в процессе выполнения программы. Эти регистры могут быть доступны для программиста

- AX (Accumulator): для арифметических операций
- CX (Counter): для хранения счетчика цикла
- DX (Data): для арифметических операций и операций ввода-вывода
- BX (Base): указатель на данные

По мере роста машинных слов расширялись и регистры. Их части именованы по следующему принципу:
- R - 64 бита (reextanded)
- E - 32 бита (extanded)
- \[A]X - 16 бит 
- \[A]H - 8 бит (старших, high)
- \[A]L - 8 бит (младших, low)

![[Pasted image 20260118153638.png]]

- SP (Stack pointer): указатель на верхушку стека
- BP (Base pointer): указатель на базу стека внутри функции
- SI (Source index): указатель на источник при операциях с массивом
- DI (Destination index): указатель на место назначения в операциях с массивами
![[Pasted image 20260118153800.png]]

##### **Сегментные регистры**
Используются для хранения адресов [[сегментов]]. Эти регистры используются для обращения к сегментам данных в [[реальном режиме]]. Смещения могут храниться в других регистрах (но не в любых).

- Регистр **CS** (**C**ode **S**egment - сегмент кода) используется для хранения сегмента кода программы. То есть в этом сегменте хранится код программы.
- Регистр **DS** (**D**ata **S**egment - сегмент данных) используется для хранения данных программы.
- Регистр **SS** (**S**tack **S**egment - сегмент стека) используется для хранения сегмента стека.
- Регистр **ES** - дополнительный регистр, который может хранить адрес любого сегмента (например, видеобуфера). Именно этот регистр наиболее часто используется в программах для работы с памятью.

##### **Регистры специального назначения** 
— обычно участвуют в управлении процессором, кэш-памятью, управлении памятью или других системных функциях. Хотя программисты обычно не работают напрямую с этими регистрами при написании прикладного программного обеспечения, они могут управлять ими через соответствующие инструкции или API для выполнения определенных задач.

- IP: указатель адреса следующей инструкции для выполнения
- FLAGS: регистр флагов, содержит биты состояния процессора
	Используется, например, в [[9. Команды переходов. Циклы|командах переходов]]

| Бит | Флаг | Значение                                              | Пояснение                                                                                                                                                                                                                                                          |
| --- | ---- | ----------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| 15  | x    |                                                       |                                                                                                                                                                                                                                                                    |
| 14  | NT   | Флаг вложенной задачи (Nested task flag)              | Управляет цепочкой прерываний                                                                                                                                                                                                                                      |
| 13  | IOPL | Уровень привилегий ввода-вывода (I/O privilege level) | Уровень привилегий текущего выполняемого потока. IOPL 0 — это режим ядра, а 3 — пользовательский режим.                                                                                                                                                            |
| 12  | IOPL | (см. выше, занимает два бита 12-13)                   |                                                                                                                                                                                                                                                                    |
| 11  | OF   | Переполнение                                          | Eсли устанавлен, то операция привела к переполнению со знаком.                                                                                                                                                                                                     |
| 10  | DF   | Флаг направления (direction)                          | Контролирует направление обработки для [[11. Обработка строковых данных\|строковых инструкций]]. Если не установлен, то порядок от самого младшего до самого старшего адреса. Если установлен, то порядок обратный — от самого старшего до самого младшего адреса. |
| 9   | IF   | Флаг разрешения прерывания (Interrupt)                |                                                                                                                                                                                                                                                                    |
| 8   | TF   | Флаг выполнения прерывания (Trap)                     | Используется при одношаговой отладке                                                                                                                                                                                                                               |
| 7   | SF   | Бит знака                                             |                                                                                                                                                                                                                                                                    |
| 6   | ZF   | Нулевой результат                                     |                                                                                                                                                                                                                                                                    |
| 5   | x    |                                                       | Зарезервирован                                                                                                                                                                                                                                                     |
| 4   | AF   | Доп перенос (Флаг настройки) (Auxiliary Carry Flag)   | Указывает, был ли при сложении перенос или заимствование при вычитании младших 4 битов<br><br>Главная функция AF — поддержка работы с двоично-десятичным кодом (BCD — Binary Coded Decimal).                                                                       |
| 3   | x    |                                                       | Зарезервирован                                                                                                                                                                                                                                                     |
| 2   | PF   | Четность                                              | Устанавливается, если младшие 8 битов результата содержат четное число единиц.                                                                                                                                                                                     |
| 1   | x    |                                                       | Зарезервирован                                                                                                                                                                                                                                                     |
| 0   | CF   | Перенос                                               | Указывает, был ли при сложении перенос или заимствование при вычитании. Используется в качестве входных данных для [[7. Типы команд. Команды перемещения данных. Арифметические операции\|инструкций сложения и вычитания]].                                       |

Регистры общего назначения имеют размер, соответствующий разрядности процессора. А регистры специального назначения уже зависят от реализации того или иного процессора. 

#### **Кэш-память процессора** 
— это сверхбыстрая память, встроенная напрямую в кристалл процессора. Она служит буфером между очень быстрым процессором и относительно медленной оперативной памятью (RAM).

***Главная цель кэша — устранение «бутылочного горлышка» [[1. Понятие архитектуры ЭВМ#^f0e7c7|фон-неймановской архитектуры]].*** Процессор работает на частотах в несколько ГГц, а оперативной памяти требуется сотни наносекунд, чтобы ответить на запрос. Без кэша процессор простаивал бы 90% времени, ожидая данные. Кэш хранит наиболее часто используемые данные «под рукой», обеспечивая их мгновенную выдачу.

### Уровни кэш-памяти (L1, L2, L3)

Современные процессоры используют иерархическую структуру кэша. Чем ниже номер уровня, тем память быстрее, но меньше по объему.

| Уровень кэша         | За что отвечает                                                               | Особенность                                                                                                                                                                                                                  | Объем                               |
| -------------------- | ----------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------- |
| L1 Cache (Уровень 1) | Самый быстрый и близкий к вычислительным блокам. Работает на частоте ядра.    | Построен по [[1. Понятие архитектуры ЭВМ#^f0e7c7\|Гарвардской архитектуре]] — разделен на две независимые части: кэш инструкций (L1i) и кэш данных (L1d). Это позволяет одновременно считывать код команды и данные для неё. | Очень мал (32–128 КБ на ядро).      |
| L2 Cache (Уровень 2) | Подстраховывает L1. Если данных нет в первом уровне, процессор ищет их здесь. | Обычно он индивидуален для каждого ядра, но значительно больше L1 по объему. Он менее скоростной, но все еще в разы быстрее оперативной памяти.                                                                              | От 256 КБ до нескольких МБ на ядро. |
| L3 Cache (Уровень 3) | Служит общим хранилищем для всех ядер процессора (в архитектурах SMP/MIMD).   | Если одно ядро вычислило данные, которые нужны другому ядру, они могут быстро передать их через L3, не обращаясь к медленной RAM. Это ключевой элемент синхронизации в многоядерных системах.                                | Самый большой (от 16 до 100+ МБ).   |

> [!info] Ключевой принцип работы кэша
> Работа кэша основана на **локальности данных**: если программа обратилась к ячейке памяти, она с высокой вероятностью скоро обратится к ней снова или к её «соседям».

##### **Строка** или **кэш-линия** (cache line) 
— последовательная группа байтов. Она представляет собой минимальную единицу данных, которую кэш может загружать из основной памяти и сохранять. Длина строки обычно составляет 32, 64 или 128 байт, в зависимости от архитектуры процессора и кэш-памяти.

Когда процессору нужно считать из памяти один байт, он извлекает не только его, но и столько смежных байтов, сколько требуется для заполнения кэш-линии, это называется **выравниванием кэш-линии.**
##### **Грязные биты** (dirty bits) 
— флаги в кэш-памяти, которые указывают на то, что данные в кэше были изменены (модифицированы) по сравнению с их копией в основной памяти (ОЗУ). Когда данные в кэше и основной памяти не совпадают, они считаются «грязными».

При вытеснении кэш-линии из кэша (например, когда кэш заполнен и необходимо освободить место для новых данных) система проверяет грязный бит. Если он установлен, данные из кэша записываются обратно в основную память, чтобы сохранить согласованность данных.











