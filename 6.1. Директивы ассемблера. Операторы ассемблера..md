# **Директива ассемблера** (псевдооператор)
—  команда, которая даёт инструкции ассемблеру о том, как должна быть организована программа. Они не влияют на выполнение программы, но управляют процессом компиляции и связывания

### **1. Группа управления структурой и сегментацией**

Эти директивы ***определяют «каркас» программы***: её модель памяти, размер стека и границы логических разделов.

| Директива   | Назначение                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | Пример                    |
| ----------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------- |
| .MODEL      | Определяет [[5. Организация памяти. Модели памяти. Способы адресации#**Модель памяти**\|модель памяти]]. Должна находиться перед любой из директив объявления сегментов<br><br>***.MODEL \[модификатор] модель\_памяти \[,соглашение\_о\_вызовах] \[,тип\_ОС] \[,параметр\_стека]***<br><br>- Модификатор: `use16` (16-битные сегменты) или `use32` (32-битные сегменты).<br>- Соглашение о вызовах: Определяет способ передачи параметров (например, `C`, `PASCAL`, `STDCALL`).<br>- Тип ОС: По умолчанию `OS_DOS`.<br>- Параметр стека: `NEARSTACK` (стек и данные в одном сегменте, [[3. Функциональная и структурная организация процессора#**Сегментные регистры**\|SS=DS]]) или `FARSTACK` (в разных сегментах, SS≠DS). | `.MODEL FLAT, STDCALL`    |
| .STACK      | Резервирует область памяти под стек                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | `.STACK 4096`             |
| .DATA       | Открывает сегмент инициализированных данных                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | `.DATA`                   |
| .DATA?      | Открывает сегмент неинициализированных данных                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | `.DATA?`                  |
| .CONST      | Открывает сегмент констант                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | `.CONST`                  |
| .CODE       | Открывает сегмент с машинным кодом                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | `.CODE`                   |
| PROC / ENDP | Обозначает начало и конец процедуры (функции)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | `Main PROC ... Main ENDP` |
| END         | Конец исходного текста и указание точки входа                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | `END Main`                |

### **2. Группа определения данных (Память)**

***Используются для выделения места в памяти*** ***под переменные*** разной разрядности.

***Директива описания данных имеет следующий формат:***

***\[<Имя>] <Директива>\[<Константа>DUP] \[(<Список инициализаторов>)]***

- <Имя> – имя поля данных, которое может не присваиваться;
- <Директива> – команда, объявляющая тип описываемых данных;
- <Константа> DUP – используются при описании повторяющихся данных, тогда константа определяет количество повторений;
- <Список инициализаторов> – последовательность инициализирующих констант, указанных через запятую, или символ «?», если инициализирующее значение не определяется.

В качестве инициализаторов при описании данных применяются:

- целые константы \[<знак>]<целое> \[<основание системы счисления>],
	-43236, 236d – целые десятичные числа,
	23h, 0ADh – целые шестнадцатеричные числа (если шестнадцатеричная константа начинается с буквы, то перед ней указывается 0),
	0111010b – целое двоичное;

- вещественные константы \[<знак>] <целое> . \[E|e \[<знак>] <целое>],
	например: -2., 34E-28;

- символы в кодировке ASCII (MS DOS) или ANSI (Windows) в апострофах или кавычках, например: 'A' или "A";

- строковые константы в апострофах или кавычках, например, 'ABCD' или "ABCD".

| Директива (полная) | Обозначение (краткое) | Размер           | Описание типа данных                                                              | Пример             |
| ------------------ | --------------------- | ---------------- | --------------------------------------------------------------------------------- | ------------------ |
| BYTE               | DB                    | 1 байт           | 8-разрядное целое (без знака — BYTE, со знаком — SBYTE) или строка                | `val1 DB 255`      |
| WORD               | DW                    | 2 байта          | 16-разрядное целое (без знака — WORD, со знаком — SWORD) или ближний указатель RM | `val2 DW 1234h`    |
| DWORD              | DD                    | 4 байта          | 32-разрядное целое (без знака — DWORD, со знаком — SDWORD) или ближний указатель  | `val3 DD 0`        |
| FWORD              | —                     | 6 bytes (48 bit) | 48-разрядное целое или дальний указатель                                          | `ptr_far FWORD ?`  |
| QWORD              | DQ                    | 8 байт           | 64-разрядное целое                                                                | `val4 DQ ?`        |
| TBYTE              | DT                    | 10 байт          | 80-разрядное целое или данные расширенной точности для FPU                        | `val5 DT 1.5`      |
| Real4              | —                     | 4 байта          | 32-х разрядное короткое вещественное число                                        | `f_val Real4 1.2`  |
| Real8              | —                     | 8 байт           | 64-х разрядное длинное вещественное число                                         | `d_val Real8 1.5`  |
| Real10             | —                     | 10 байт          | 80-ти разрядное расширенное вещественное число                                    | `e_val Real10 1.1` |
| —                  | DUP                   | —                | Оператор повторения данных; константа перед DUP определяет количество повторений  | `DB 100 DUP (0)`   |

### **3. Группа выбора архитектуры (Процессорная)**

***Указывает ассемблеру, команды какого поколения процессоров разрешено использовать.***

| Директива | Описание            | Доступные возможности              |
| --------- | ----------------------- | -------------------------------------- |
| .386      | Инструкции Intel 80386  | 32-битные регистры и адресация         |
| .486      | Инструкции Intel 80486  | Инструкции встроенного со-процессора   |
| .586      | Инструкции Pentium      | Расширенный набор команд IA-32         |
| .686      | Инструкции Pentium Pro  | Современные оптимизации команд         |
| .586P     | Привилегированный режим | Разрешает команды ядра ОС (LIDT, LGDT) |

### **4. Группа внешних связей (Модульная)**

***Используется, если программа состоит из нескольких файлов или подключает библиотеки.***

| Директива  | Назначение                               | Пример               |
| ---------- | -------------------------------------------- | ------------------------ |
| INCLUDE    | Вставка текста из другого файла              | `INCLUDE windows.inc`    |
| INCLUDELIB | Подключение библиотеки функций               | `INCLUDELIB user32.lib`  |
| PUBLIC     | Сделать переменную/процедуру доступной извне | `PUBLIC MyVar`           |
| EXTRN      | Описать символ, определенный в другом файле  | `EXTRN ExitProcess:PROC` |

# **Оператор ассемблера**
— ***одна логически завершенная строка программы.*** В отличие от высокоуровневых языков, где один оператор (например, `print`) может превращаться в сотни машинных команд, в ассемблере одна строка почти всегда соответствует одной команде процессора или одному указанию для компилятора.

***Все операторы делятся на четыре основных типа:***

| Тип оператора                  | Суть и роль в программе                               | Пример (MASM/x86)            | Когда обрабатывается        |
| ---------------------------------- | --------------------------------------------------------- | -------------------------------- | ------------------------------- |
| 1. Машинные инструкции         | Команды процессору на выполнение физических действий.     | `mov eax, ebx`, `add ecx, 10`    | Во время выполнения (Runtime)   |
| 2. Директивы (Псевдооператоры) | Указания компилятору по организации кода и памяти.        | `.data`, `my_var dd 0`, `db 'A'` | Во время сборки (Assembly time) |
| 3. Макрокоманды                | Заготовки, разворачивающиеся в группу инструкций.         | `mMyMacro`, `INVOKE ExitProcess` | Во время препроцессинга         |
| 4. Директивы управления        | Условная компиляция (включение/исключение участков кода). | `IF`, `ELSE`, `ENDIF`            | Во время сборки (Assembly time) |
    

### **Структура оператора (строки кода)**

Почти любой оператор ассемблера строится по строгому шаблону из четырех полей:

1. *Метка (Label):* (Необязательно) Имя адреса в памяти, чтобы на него можно было сослаться (например, для цикла или перехода). Заканчивается двоеточием.
    
2. *Мнемоника (Mnemonic)*: (Обязательно для инструкций) Краткое название команды (например, `ADD`, `SUB`, `PUSH`).
    
3. *Операнды (Operands):* Аргументы команды. Это могут быть регистры, адреса памяти или числа. Их может быть от 0 до 3.
    
4. *Комментарий:* Все, что идет после точки с запятой `;`. Игнорируется компилятором.