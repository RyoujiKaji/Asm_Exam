# **Основные понятия и [[5. Организация памяти. Модели памяти. Способы адресации#Режимы адресации операндов**|адресация]]**

***Массив в памяти представляет собой последовательность однотипных элементов, расположенных друг за другом***. Для доступа к конкретному элементу необходимо знать адрес начала массива и размер одного элемента.

***Эффективный адрес*** (смещение от начала сегмента) вычисляется по формуле:

*Адрес = База + (Индекс * Масштаб) + Смещение.*

- *База*: любой регистр общего назначения.
- *Индекс*: любой регистр общего назначения, кроме `ESP`.
- *Масштаб*: константа 1, 2, 4 или 8 (соответствует размеру данных в байтах).
- *Смещение*: числовое значение.
    
# **Способы загрузки адреса начала массива**

Для начала обработки массива необходимо загрузить его начальный адрес в регистр (обычно `ESI`, `EDI` или `EBX`):

- ***Команда* `MOV`**: используется оператор `OFFSET` (адрес определяется на этапе ассемблирования), например: `mov esi, OFFSET mass`.
- ***Команда* `LEA`**: вычисляет адрес на этапе выполнения программы: `lea esi, mass`.
    
# **Типы адресации при работе с массивами**

| Тип адресации            | Формат записи (пример) | Описание механизма                                                                               | Применение                                                                           |
| ---------------------------- | -------------------------- | ---------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------- |
| Прямая с индексированием | `mass[esi]` 1              | Используется прямой адрес начала массива и регистр-смещение (SI, DI, BX или BP)2.                    | Доступ к элементам, когда имя массива известно заранее3.                                 |
| Косвенная                | `[esi]` 4444               | Адрес начала массива предварительно загружается в регистр (через `LEA` или `MOV`)5555.               | Полный уход от использования прямого имени переменной в команде6.                        |
| Базово-индексная         | `[ebx+esi]` 7              | Процессор складывает значения двух регистров (базового и индексного)8.                               | Удобна для двумерных массивов (база — строка, индекс — столбец)9999.                     |
| С масштабированием       | `a[ebx*4]` 10              | Индексный регистр умножается на масштаб (2, 4 или 8), соответствующий размеру типа данных1111111111. | Позволяет использовать в регистре порядковый номер элемента вместо байтового смещения12. |
    

## **Организация [[9. Команды переходов. Циклы#*3. Цикл со счетчиком (for)*|циклов]] для обработки**

Для перебора элементов массива стандартно используется команда [[9. Команды переходов. Циклы#`LOOP`|`LOOP`]] и регистр-счетчик `ECX`.

***Пример цикла (подсчет нулевых значений):***

```masm
lea esi, mass   ; загрузка адреса начала массива
mov ecx, 8      ; количество элементов
cycle:
    cmp [esi], 0 ; сравнение текущего элемента с нулем
    jnz nxt      ; если не ноль — переход к nxt
    inc ebx      ; если ноль — инкремент счетчика нулей
nxt: 
    add esi, 4   ; переход к следующему элементу (размером 4 байта)
    loop cycle   ; уменьшить ecx и повторить, если ecx != 0
```

# **Обработка двумерных** **массивов**

Двумерный массив (матрица) может обрабатываться двумя способами:

1. *Как одномерный массив*: последовательный доступ ко всем элементам подряд (`количество строк * количество столбцов`).
    
2. *Вложенными циклами*: внешний цикл по строкам, внутренний — по элементам строки. При переходе к следующей строке к базовому регистру прибавляется размер всей строки (`количество элементов * размер типа`).
    
Для *вычисления адреса элемента* `M[i][j]` используется формула: *Адрес = Начало + (i * количество_столбцов + j) * размер_элемента*